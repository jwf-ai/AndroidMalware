# encoding: utf-8

from urllib import request
import pickle
import PyPDF2


def get_response(url,timeout):
    response = request.urlopen(url,timeout=timeout)
    return response

def get_file(url,file_name):
    response = get_response(url)
    file = open(file_name,'wb')
    block_size = 8192
    while True:
        buffer = response.read(block_size)
        if not buffer:
            break
        file.write(buffer)
    file.close()

def get_html(url,timeout):
    response = get_response(url,timeout=timeout)
    return response.read().decode('utf-8')

def save_pkl(obj, file_name):
    pickle.dump(obj,open(file_name,'wb'))

def load_pkl(file_name):
    return pickle.load(open(file_name,'rb'))

def check_pdf(file_name):
    valid = True
    try:
        reader = PyPDF2.PdfFileReader(file_name)
        if reader.getNumPages() < 1:
            valid = False
    except:
        valid = False
    return valid

if __name__ == "__main__":
    paper_list= load_pkl("long_paper_list.pkl")
    url = list(paper_list.values())[0]
    print(url)
    get_file(url,"test.pdf")