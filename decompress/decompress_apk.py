# encoding: utf-8
import os
import config
import log
import utils

def decompress_by7z(src_path, des_path):
    try:
        smali_jar_path = config.LIB_BAKSMALI_PATH
        cmd ="java -jar {0} d {1} -o {2}".format(smali_jar_path,src_path,des_path)
        print(cmd)
        os.system(cmd)
    except Exception as e:
        log.write(filename="apk2smali.txt",message=str(e),remark=src_path)

if __name__ == "__main__":
    dir_path = "E:\\WorkPlaces\\PY_WorkPlace\\Tools\\APK_crawler\\apks"
    files = utils.get_files_from_dir(dir_path, file_type=".apk")
    count = len(files)
    print("Get {0} files".format(count))

    for file in files:
        des_path = os.path.join(config.DATA_BENIGN_SMALI_PATH,file.split("\\")[-1])
        if os.pat.exist(des_path) == False:
            decompress_by7z(file,des_path)
            count -= 1
            log.write(filename="apk2smali.txt", message=str(count)+" left to convert", type="INFO")



